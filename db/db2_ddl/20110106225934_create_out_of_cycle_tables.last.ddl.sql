---------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_GROUP_TYPE
---------------------------------------------------
CONNECT TO SWARE_L;

CREATE TABLE HIP.HIP_OOC_GROUP_TYPE (
OOC_GROUP_TYPE			VARCHAR(20) NOT NULL,
OOC_GROUP_TYPE_DESC	VARCHAR(254),
LU_USERID						VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP				TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP
)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_GROUP_TYPE
	ADD CONSTRAINT HIP_OOC_GROUP_TYPE_PK PRIMARY KEY (OOC_GROUP_TYPE)
;


------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_SCAN_TYPE
------------------------------------------------
CREATE TABLE HIP.HIP_OOC_SCAN_TYPE (
OOC_SCAN_TYPE				VARCHAR(20) NOT NULL,
OOC_SCAN_TYPE_DESC	VARCHAR(254),
OOC_GROUP_TYPE			VARCHAR(20) NOT NULL,
OOC_SCAN_PUBLISH		CHAR(1) NOT NULL,
OOC_ECM_SCAN_TYPE		VARCHAR(20),
LU_USERID						VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP				TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP
)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_SCAN_TYPE
	ADD CONSTRAINT HIP_OOC_SCAN_TYPE_PK PRIMARY KEY (OOC_SCAN_TYPE)
	ADD CONSTRAINT HIP_OOC_SCAN_TYPE_FK1 FOREIGN KEY (OOC_GROUP_TYPE) REFERENCES HIP.HIP_OOC_GROUP_TYPE (OOC_GROUP_TYPE)
	ADD CONSTRAINT HIP_OOC_SCAN_TYPE_CK1 CHECK (OOC_SCAN_PUBLISH IN ('y', 'n'))
;


------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_GROUP
------------------------------------------------
CREATE TABLE HIP.HIP_OOC_GROUP (
OOC_GROUP_ID		INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (  
											START WITH +1 INCREMENT BY +1 CACHE 20  ) ,
ORG_L1_ID				INTEGER NOT NULL ,
ORG_ID					INTEGER NOT NULL ,
OOC_GROUP_NAME	VARCHAR(80) NOT NULL ,
OOC_GROUP_STATUS VARCHAR(15) NOT NULL ,
OOC_GROUP_TYPE	VARCHAR(20) NOT NULL ,
CREATED_AT			TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP,
LU_USERID				VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP		TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_GROUP
	ADD CONSTRAINT HIP_OOC_GROUP_PK PRIMARY KEY (OOC_GROUP_ID)
	ADD CONSTRAINT HIP_OOC_GROUP_UK1 UNIQUE (OOC_GROUP_NAME, OOC_GROUP_TYPE, ORG_L1_ID, ORG_ID)
	ADD CONSTRAINT HIP_OOC_GROUP_FK1 FOREIGN KEY (ORG_L1_ID, ORG_ID) REFERENCES SWARE.DIM_COMM_ORG (ORG_L1_ID, ORG_ID)
	ADD CONSTRAINT HIP_OOC_GROUP_FK2 FOREIGN KEY (OOC_GROUP_TYPE) REFERENCES HIP.HIP_OOC_GROUP_TYPE (OOC_GROUP_TYPE)
	ADD CONSTRAINT HIP_OOC_GROUP_CK1 CHECK (OOC_GROUP_STATUS IN ('active', 'deleted', 'inactive'))
;


------------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_ASSET_GROUP
------------------------------------------------------
CREATE TABLE HIP.HIP_OOC_ASSET_GROUP (
OOC_GROUP_ID	INTEGER NOT NULL,
ASSET_ID			INTEGER NOT NULL,
LU_USERID			VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP	TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_ASSET_GROUP
	ADD CONSTRAINT HIP_OOC_ASSET_GROUP_PK PRIMARY KEY (OOC_GROUP_ID, ASSET_ID)
	ADD CONSTRAINT HIP_OOC_ASSET_GROUP_FK1 FOREIGN KEY (OOC_GROUP_ID) REFERENCES HIP.HIP_OOC_GROUP (OOC_GROUP_ID)
;


------------------------------------------------
-- DDL Statements for table HIP.HIP_MISSED_SCAN
------------------------------------------------
CREATE TABLE HIP.HIP_OOC_MISSED_SCAN  (
OOC_MISSED_SCAN_ID 		INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (  
											START WITH +1 INCREMENT BY +1 CACHE 20 ) , 
OOC_GROUP_ID 					INTEGER NOT NULL , 
OOC_SCAN_TYPE					VARCHAR(20) NOT NULL,
ASSET_ID							INTEGER NOT NULL , 
MISSED_SCAN_REASON_ID SMALLINT NOT NULL , 
LU_USERID							VARCHAR(20) NOT NULL WITH DEFAULT 'unk' , 
LU_TIMESTAMP					TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP )   
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_MISSED_SCAN
	ADD CONSTRAINT HIP_OOC_MISSED_SCAN_PK PRIMARY KEY (OOC_MISSED_SCAN_ID)
	ADD CONSTRAINT HIP_OOC_MISSED_SCAN_UK1 UNIQUE (OOC_GROUP_ID, OOC_SCAN_TYPE, ASSET_ID)
	ADD CONSTRAINT HIP_OOC_MISSED_SCAN_FK1 FOREIGN KEY (OOC_GROUP_ID) REFERENCES HIP.HIP_OOC_GROUP (OOC_GROUP_ID)
	ADD CONSTRAINT HIP_OOC_MISSED_SCAN_FK2 FOREIGN KEY (MISSED_SCAN_REASON_ID) REFERENCES HIP.HIP_MISSED_SCAN_REASON (MISSED_SCAN_REASON_ID)
	ADD CONSTRAINT HIP_OOC_MISSED_SCAN_FK3 FOREIGN KEY (OOC_SCAN_TYPE) REFERENCES HIP.HIP_OOC_SCAN_TYPE (OOC_SCAN_TYPE)
;


------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_SCAN
------------------------------------------------
CREATE TABLE HIP.HIP_OOC_SCAN (
SCAN_ID										INTEGER NOT NULL,
ORG_L1_ID									INTEGER NOT NULL,
ORG_ID										INTEGER NOT NULL,
OOC_GROUP_ID							INTEGER NOT NULL,
ASSET_ID									INTEGER NOT NULL,
TOOL_ID										SMALLINT NOT NULL,
TOOL_NAME									VARCHAR(20) NOT NULL,
OOC_SCAN_TYPE							VARCHAR(20) NOT NULL,
SCAN_START_TIMESTAMP			TIMESTAMP NOT NULL,
PUBLISH_READY_TIMESTAMP		TIMESTAMP,
PUBLISH_READY_USERID			VARCHAR(20),
PUBLISH_TIMESTAMP					TIMESTAMP,
LU_USERID									VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP							TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_SCAN
	ADD CONSTRAINT HIP_OOC_SCAN_PK PRIMARY KEY (SCAN_ID)
	ADD CONSTRAINT HIP_OOC_SCAN_FK1 FOREIGN KEY (SCAN_ID) REFERENCES SWARE.DIM_COMM_TOOL_ASSET_SCAN_HIST (SCAN_ID)
	ADD CONSTRAINT HIP_OOC_SCAN_FK2 FOREIGN KEY (ORG_L1_ID, ORG_ID) REFERENCES SWARE.DIM_COMM_ORG (ORG_L1_ID, ORG_ID)
	ADD CONSTRAINT HIP_OOC_SCAN_FK3 FOREIGN KEY (OOC_GROUP_ID) REFERENCES HIP.HIP_OOC_GROUP (OOC_GROUP_ID)
	ADD CONSTRAINT HIP_OOC_SCAN_FK4 FOREIGN KEY (OOC_SCAN_TYPE) REFERENCES HIP.HIP_OOC_SCAN_TYPE (OOC_SCAN_TYPE)
	ADD CONSTRAINT HIP_OOC_SCAN_FK5 FOREIGN KEY (TOOL_ID) REFERENCES SWARE.DIM_COMM_TOOL (TOOL_ID)
;

CREATE INDEX HIP_OOC_SCAN_I1 ON HIP.HIP_OOC_SCAN (OOC_GROUP_ID, ASSET_ID, OOC_SCAN_TYPE)
;


-------------------------------------------------------------
-- DDL Statements for table HIP.HIP_OOC_SCAN_FINDING_VALID
-------------------------------------------------------------
CREATE TABLE HIP.HIP_OOC_SCAN_FINDING_VALID (
SCAN_ID				INTEGER NOT NULL,
FINDING_VID		INTEGER NOT NULL,
LU_USERID			VARCHAR(20) NOT NULL WITH DEFAULT 'unk',
LU_TIMESTAMP	TIMESTAMP NOT NULL WITH DEFAULT CURRENT TIMESTAMP)
IN TS_DIM1_32K INDEX IN TS_INDEX1_4K
;

ALTER TABLE HIP.HIP_OOC_SCAN_FINDING_VALID
	ADD CONSTRAINT HIP_OOC_SCAN_FINDING_PK PRIMARY KEY (SCAN_ID, FINDING_VID)
	ADD CONSTRAINT HIP_OOC_SCAN_FINDING_FK2 FOREIGN KEY (SCAN_ID) REFERENCES SWARE.DIM_COMM_TOOL_ASSET_SCAN_HIST (SCAN_ID)
	ADD CONSTRAINT HIP_OOC_SCAN_FINDING_FK3 FOREIGN KEY (FINDING_VID) REFERENCES SWARE.FACT_SCAN (FINDING_VID)
;

-------------------------------------------------------------
-- DDL Statements for related views
-------------------------------------------------------------
CREATE VIEW HIP.HIP_OOC_GROUP_TYPE_V AS SELECT * FROM HIP.HIP_OOC_GROUP_TYPE;
CREATE VIEW HIP.HIP_OOC_SCAN_TYPE_V AS SELECT * FROM HIP.HIP_OOC_SCAN_TYPE;
CREATE VIEW HIP.HIP_OOC_ASSET_GROUP_V AS SELECT * from HIP.HIP_OOC_ASSET_GROUP;
CREATE VIEW HIP.HIP_OOC_GROUP_V AS SELECT * from HIP.HIP_OOC_GROUP;
CREATE VIEW HIP.HIP_OOC_MISSED_SCAN_V AS SELECT * from HIP.HIP_OOC_MISSED_SCAN;
CREATE VIEW HIP.HIP_OOC_SCAN_V AS SELECT * from HIP.HIP_OOC_SCAN;
CREATE VIEW HIP.HIP_OOC_SCAN_FINDING_VALID_V AS SELECT * from HIP.HIP_OOC_SCAN_FINDING_VALID;


--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-- Note to DBA:  Add grants here!
--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
